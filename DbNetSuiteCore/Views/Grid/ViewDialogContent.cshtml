@namespace DbNetSuiteCore.ViewModels
@using DbNetSuiteCore.Models
@using DbNetSuiteCore.Extensions
@using DbNetSuiteCore.Helpers
@using System.Data
@model GridViewDialogViewModel

@{
    int layoutColumns = Model.GridModel.ViewDialogLayoutColumns < Model.ColumnCount ? Model.GridModel.ViewDialogLayoutColumns : Model.ColumnCount;
    int remainder = Model.ColumnCount % layoutColumns;
    int rows = Math.Abs(Model.ColumnCount / layoutColumns) + (remainder == 0 ? 0 : 1);
}

<table class="table-auto border-collapse m-1" @RazorHelper.RowDataAttributes(Model.Row, Model.GridModel)>
    <tbody>
        @for (int r = 0; r < rows; r++)
        {
            <tr>
                @for (int c = 1; c <= layoutColumns; c++)
                {
                    int i = r + ((c - 1) * rows);
                    @if (i < Model.ColumnCount)
                    {
                        GridColumn gridColumn = Model.Columns.ToList()[i];
                        DataColumn? dataColumn = Model.GridModel.GetDataColumn(gridColumn);
                        var classes = new List<string>() { "text-base" };
                        var value = Model.Row[dataColumn!];
                        if (gridColumn.IsNumeric && gridColumn.Lookup == null)
                        {
                            classes.Add("text-right");
                        }

                        var formattedvalue = gridColumn.FormatValue(value);

                        <td class="font-bold" data-columnname="@gridColumn.ColumnName">@(gridColumn.Label)</td>
                        <td @RazorHelper.CellDataAttributes(classes, value, gridColumn.Style)>@(formattedvalue)</td>

                        if (c > 0 && c < layoutColumns)
                        {
                            <td>&nbsp;</td>
                        }
                    }
                    else
                    {
                        if (remainder > 0)
                        {
                            <td colspan="2"></td>
                        }
                    }
                }

            </tr>
        }
    </tbody>
</table>

