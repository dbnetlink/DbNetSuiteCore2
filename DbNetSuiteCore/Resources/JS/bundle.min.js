var DbNetSuiteCore={},controlArray={};DbNetSuiteCore.controlArray=controlArray;DbNetSuiteCore.createClientControl=function(n,t){document.addEventListener("htmx:afterRequest",function(i){if(!DbNetSuiteCore.controlArray[n]){var r={};n.startsWith("Grid")&&(r=new GridControl(n));n.startsWith("Select")&&(r=new SelectControl(n));n.startsWith("Form")&&(r=new FormControl(n));for(const[n,i]of Object.entries(t))r.eventHandlers[n]=window[i.toString()];DbNetSuiteCore.controlArray[n]=r}DbNetSuiteCore.controlArray[n].afterRequest(i)})};class ComponentControl{constructor(n){this.controlId="";this.childControls={};this.eventHandlers={};this.isElementLoaded=async n=>{while(document.querySelector(n)===null)await new Promise(n=>requestAnimationFrame(n));return document.querySelector(n)};this.controlId=n;this.form=document.querySelector(this.formSelector());this.form.style.display="";this.controlContainer=this.form.parentElement}setCaption(n){var t=this.controlElement("div.caption");t&&(t.innerText=n)}invokeEventHandler(n,t={}){this.eventHandlers.hasOwnProperty(n)!=!1&&(typeof this.eventHandlers[n]=="function"?this.eventHandlers[n](this,t):this.toast(`Javascript function for event type '${n}' is not defined`,"error",3))}eventHandlerAttached(n){return typeof this.eventHandlers[n]=="function"}toast(n,t="info",i=1){var r=this.controlContainer.querySelector("#toastMessage");if(r.querySelector("span").innerText=n,n==""){r.parentElement.style.marginLeft=`-${r.parentElement.clientWidth/2}px`;r.parentElement.style.marginTop=`-${r.parentElement.clientHeight/2}px`;r.parentElement.style.display="none";return}r.parentElement.style.display="block";let u=this;window.setTimeout(()=>{u.toast("")},i*1e3)}formSelector(){return`#${this.controlId}`}controlElements(n){return this.form.querySelectorAll(n)}controlElement(n){return this.form.querySelector(n)}triggerName(n){let t=n.detail.headers?n.detail.headers:n.detail.requestConfig.headers;return t["HX-Trigger-Name"]?t["HX-Trigger-Name"].toLowerCase():""}triggerElement(n){return n.detail.requestConfig.elt}updateLinkedControls(n,t,i=null){var r=n.split(",");r.forEach(n=>{this.isElementLoaded(`#${n}`).then(()=>{var r=DbNetSuiteCore.controlArray[n];r.parentControl=this;this.childControls[n]=r;i!=null&&r.dataSourceIsFileSystem()&&(t=i);r.loadFromParent(t)})})}notifyParent(n){this.parentControl&&this.parentControl.childLoaded(n)}childLoaded(n){if(this instanceof FormControl){let t=this.getButton("delete");t&&(t.disabled=n)}}dataSourceIsFileSystem(){return this.form.dataset.datasourcetype=="FileSystem"}loadFromParent(n){let t=`#${this.controlId} input[name="primaryKey"]`,i=htmx.find(t);this.form.setAttribute("hx-vals",JSON.stringify({primaryKey:n}));i?htmx.trigger(t,"changed"):htmx.trigger(`#${this.controlId}`,"submit")}toolbarExists(){return this.controlElement("#navigation")}removeClass(n,t){let i=this.controlElement(n);i&&i.classList.remove(t)}addClass(n,t){let i=this.controlElement(n);i&&i.classList.add(t)}getButton(n){return this.controlElement(this.buttonSelector(n))}buttonSelector(n){return`button[button-type="${n}"]`}setPageNumber(n,t,i){var u=this.controlElement(`[name="${i}"]`),r,f;if(u.childElementCount!=t)for(u.querySelectorAll("option").forEach(n=>n.remove()),r=1;r<=t;r++)f=document.createElement("option"),f.value=r.toString(),f.text=r.toString(),u.appendChild(f);u.value=n.toString()}isControlEvent(n){let t=n.target.closest("form").id;return t.startsWith(this.controlId)}}class GridControl extends ComponentControl{constructor(n){super(n);this.bgColourClass="bg-cyan-600";this.textColourClass="text-zinc-100"}afterRequest(n){let u=n.target.closest("form").id;if(u.startsWith(this.controlId)!=!1&&n.detail.elt.name!="nestedGrid"){let i=null;switch(this.triggerName(n)){case"viewdialogcontent":this.viewDialog.show();this.invokeEventHandler("ViewDialogUpdated",{viewDialog:this.viewDialog});return;case"refresh":let t=JSON.parse(this.triggerElement(n).getAttribute("hx-vals"));i=t.rowIndex}if(this.controlElement("tbody")){this.configureNavigation();this.configureSortIcon();this.triggerName(n)=="initialload"&&this.initialise();this.controlElements(".nested-icons").forEach(n=>{let t=n.querySelectorAll("span");t[0].addEventListener("click",n=>this.showHideNestedGrid(n,!0));t[1].addEventListener("click",n=>this.showHideNestedGrid(n,!1))});this.controlElements("tr.grid-row").forEach(n=>{this.invokeEventHandler("RowTransform",{row:n})});this.controlElements("td[data-value]").forEach(n=>{this.invokeCellTransform(n)});this.controlElements("tbody a").forEach(n=>{n.classList.remove("selected"),n.classList.add("underline")});this.rowSelection()!="none"&&(this.controlElement(this.multiRowSelectAllSelector())?(this.controlElement(this.multiRowSelectAllSelector()).addEventListener("change",n=>{this.updateMultiRowSelect(n)}),this.controlElements(this.multiRowSelectSelector()).forEach(n=>{n.addEventListener("change",n=>{this.selectRow(n.target,!0)})})):htmx.findAll(this.rowSelector()).forEach(n=>{n.addEventListener("click",n=>this.selectRow(n.target))}));let r=document.querySelector(this.rowSelector(i));r&&r.click();this.controlElements("tr.column-filter-refresh select").forEach(n=>{let t=this.controlElement(`thead select[data-key="${n.dataset.key}"]`);t&&(t.innerHTML=n.innerHTML)});this.controlElements("thead input[data-key]").forEach(n=>{n.title="",n.style.backgroundColor=""});this.controlElements("tr.column-filter-error span").forEach(n=>{let t=this.controlElement(`thead input[data-key="${n.dataset.key}"]`);t.title=n.innerText;t.style.backgroundColor="rgb(252 165 165)"});let t=this.controlElement("thead");t.dataset.frozen.toLowerCase()=="true"&&(t.style.top=`0px`,t.style.position="sticky",t.style.zIndex="1");this.invokeEventHandler("PageLoaded")}}}initialise(){this.toolbarExists()&&(this.getButton("copy").addEventListener("click",()=>this.copyTableToClipboard()),this.getButton("export").addEventListener("click",()=>this.download()));var n=this.controlElement(".view-dialog");n&&(this.viewDialog=new ViewDialog(n,this));this.invokeEventHandler("Initialised")}refreshPage(){let n=`#${this.controlId} input[name="refresh"]`,t=htmx.find(n);this.form.setAttribute("hx-vals",JSON.stringify({rowIndex:this.selectedRow.rowIndex}));t.setAttribute("hx-vals",JSON.stringify({rowIndex:this.selectedRow.rowIndex}));htmx.trigger(n,"changed")}invokeCellTransform(n){var t=this.controlElement("thead").children[0].children[n.cellIndex].dataset.columnname,i={cell:n,columnName:t};this.invokeEventHandler("CellTransform",i)}configureNavigation(){let r=this.controlElement("tbody"),t=parseInt(r.dataset.currentpage),n=parseInt(r.dataset.totalpages),i=parseInt(r.dataset.rowcount);if(n==0&&this.updateLinkedGrids(""),this.notifyParent(i>0),this.viewDialog&&(this.getButton("view").disabled=i==0,i==0&&this.viewDialog.close()),this.toolbarExists()){let r=parseInt(this.controlElement("#query-limited").dataset.querylimit);n==0?(this.removeClass("#no-records","hidden"),this.addClass("#navigation","hidden")):(this.addClass("#no-records","hidden"),this.removeClass("#navigation","hidden"));r>0&&r==i?this.removeClass("#query-limited","hidden"):this.addClass("#query-limited","hidden");this.setPageNumber(t,n,"page");this.controlElement('[data-type="total-pages"]').value=n.toString();this.controlElement('[data-type="row-count"]').value=i.toString();this.getButton("first").disabled=t==1;this.getButton("previous").disabled=t==1;this.getButton("next").disabled=t==n;this.getButton("last").disabled=t==n}}rowSelection(){let n=this.controlElement("thead");return n.dataset.rowselection.toLowerCase()}configureSortIcon(){if(this.controlElements(`th[data-key]`).length!=0){let t=this.controlElement("tbody"),i=t.dataset.sortkey,r=t.querySelector("span#sortIcon").innerHTML;this.controlElements(`th[data-key] span`).forEach(n=>n.innerHTML="");let n=this.controlElement(`th[data-key="${i}"] span`);n||(n=this.controlElements(`th[data-key] span`)[0]);n.innerHTML=r}}showHideNestedGrid(n,t){n.stopPropagation();let u=n.target.closest("tr"),i=u.firstElementChild.querySelectorAll("span"),r=u.nextElementSibling;r&&r.classList.contains("nested-grid-row")?r.style.display=t?null:"none":t&&htmx.trigger(i[2],"click");i[0].style.display=t?"none":"block";i[1].style.display=t?"block":"none"}refresh(){let n=this.controlElement('[name="page"]');n.value="1";htmx.trigger(n,"changed")}updateMultiRowSelect(n){let t=n.target.checked;this.controlElements(this.multiRowSelectSelector()).forEach(n=>{n.checked=t,this.selectRow(n)});this.selectedValuesChanged()}selectRow(n,t=false){let i=n.closest("tr");if(n.classList.contains("multi-select")==!1){if(i.classList.contains(this.bgColourClass))return;this.clearHighlighting(null)}else if(n.checked==!1){this.clearHighlighting(i);t&&this.selectedValuesChanged();return}i.classList.add(this.bgColourClass,this.textColourClass);i.querySelectorAll("a").forEach(n=>n.classList.add("selected"));i.querySelectorAll("td[data-value] > div > svg,td[data-isfolder] svg,td > div.nested-icons svg").forEach(n=>n.setAttribute("fill","#ffffff"));this.updateLinkedGrids(i.dataset.id);this.selectedRow=i;this.viewDialog&&(this.viewDialog.configureNavigation(i),this.viewDialog.update());this.invokeEventHandler("RowSelected",{selectedRow:i});t&&this.selectedValuesChanged()}selectedValuesChanged(){this.invokeEventHandler("SelectedRowsUpdated",{selectedValues:this.selectedValues()})}updateLinkedGrids(n){let t=this.controlElement("table");t.dataset.linkedcontrolids&&this.updateLinkedControls(t.dataset.linkedcontrolids,n)}clearHighlighting(n){n?this.clearRowHighlight(n):this.controlElements(this.rowSelector()).forEach(n=>{this.clearRowHighlight(n.closest("tr"))})}clearRowHighlight(n){n.classList.remove(this.bgColourClass,this.textColourClass);n.querySelectorAll("a").forEach(n=>n.classList.remove("selected"));n.querySelectorAll("td[data-value] > div > svg,td[data-isfolder] svg,td > div.nested-icons svg").forEach(n=>n.setAttribute("fill","#666666"))}copyTableToClipboard(){var n=this.controlElement("table");try{this.copyElementToClipboard(n);this.toast("Page copied to clipboard")}catch(t){try{const t=n.innerHTML,i=new Blob([t],{type:"text/html"}),r=new ClipboardItem({"text/html":i});navigator.clipboard.write([r]);this.toast("Page copied to clipboard")}catch(t){this.toast("Copy failed","error",5);return}}}copyElementToClipboard(n){window.getSelection().removeAllRanges();let t=document.createRange();t.selectNode(typeof n=="string"?document.getElementById(n):n);window.getSelection().addRange(t);document.execCommand("copy");window.getSelection().removeAllRanges()}previousRow(){this.selectedRow.previousElementSibling.click()}nextRow(){this.selectedRow.nextElementSibling.click()}download(){this.showIndicator();const n=new URLSearchParams;for(let[t,i]of new FormData(this.form))n.append(t,i);var t=this.controlElement('[name="exportformat"]').value;fetch("gridcontrol.htmx",{method:"post",body:n,headers:{"hx-trigger-name":"download"}}).then(n=>{if(this.hideIndicator(),n.headers.has("error"))throw new Error(n.headers.get("error"));else return n.blob()}).then(n=>{n&&(t=="html"?this.openWindow(n):this.downloadFile(n,t))}).catch(n=>console.log(`Critical failure: ${n.message}`))}openWindow(n){const t=window.URL.createObjectURL(n),i=window.open();i.location.href=t}downloadFile(n,t){const i=document.createElement("a");i.href=window.URL.createObjectURL(n);t=t=="excel"?"xlsx":t;i.download=`report_${(new Date).getTime()}.${t}`;this.invokeEventHandler("FileDownload",{link:i,extension:t});i.click()}showIndicator(){this.indicator().classList.add("htmx-request")}hideIndicator(){this.indicator().classList.remove("htmx-request")}indicator(){return this.controlContainer.children[1]}rowSelector(n=null){var t=n?`tr:nth-child(${n-1})`:"tr.grid-row";return`#tbody${this.controlId} > ${t}`}multiRowSelectAllSelector(){return`th > input.multi-select`}multiRowSelectSelector(){return`td > input.multi-select`}gridControlElement(n){return this.controlElement(n)}selectedValues(){let n=[];return this.controlElements(this.multiRowSelectSelector()).forEach(t=>{if(t.checked){let i=t.closest("tr");i.dataset.id&&n.push(i.dataset.id)}}),n}columnCells(n){let t=this.heading(n);return this.controlElements(`td:nth-child(${t.cellIndex+1})`)}heading(n){return this.controlElement(`th[data-columnname='${n.toLowerCase()}']`)}columnCell(n,t){let i=this.heading(n);return i?t.querySelector(`td:nth-child(${i.cellIndex+1})`):null}columnValue(n,t){t||(t=this.selectedRow);let i=t.dataset[n.toLowerCase()];if(i)return i;let r=this.columnCell(n,t);return r?r.dataset.value:null}}class SelectControl extends ComponentControl{constructor(n){super(n)}afterRequest(n){let i=n.target.closest("form").id;if(i.startsWith(this.controlId)!=!1){this.select=this.controlElement("select");let t=this.controlElements("select");this.select.innerHTML=t[1].innerHTML;t[1].remove();this.triggerName(n)=="initialload"&&this.initialise();this.invokeEventHandler("OptionsLoaded");this.selectChanged(this.select);this.checkForError()}}initialise(){this.controlElement("select").addEventListener("change",n=>{this.selectChanged(n.target)});this.invokeEventHandler("Initialised")}selectChanged(n){let i="";if(n.selectedOptions.length){var t=n.selectedOptions[0].dataset;i=this.dataSourceIsFileSystem()&&t.isdirectory&&t.isdirectory.toLowerCase()=="true"?t.path:""}this.updateLinkedChildControls(n.value,i);this.invokeEventHandler("OptionSelected",{selectedOptions:n.selectedOptions})}updateLinkedChildControls(n,t){this.select.dataset.linkedcontrolids&&this.updateLinkedControls(this.select.dataset.linkedcontrolids,n,t)}checkForError(){var n=this.controlElement("select");const t=n.querySelector("div");t&&n.parentElement.nextElementSibling.after(t)}}class FormControl extends ComponentControl{constructor(n){super(n);this.htmlEditorArray={};this.htmlEditorMissing=!1}afterRequest(n){if(this.isControlEvent(n)==!1)return!1;if(this.triggerName(n)!="toolbar"&&(this.formContainer=this.controlElement("div.form-container"),this.formBody=this.controlElement("div.form-body"),this.formMessage=this.controlElement("#form-message"),this.formBody)){this.notifyParent(this.formBody.dataset.mode.toLowerCase()=="update");switch(this.triggerName(n)){case"initialload":this.initialise();break;default:this.htmlEditorMissing==!1&&this.htmlEditorElements().forEach(n=>{this.htmlEditorArray[n.id].reset(n)})}this.cachedMessage&&this.setMessage(this.cachedMessage);this.updateLinkedChildControls(this.formBody.dataset.id);window.setTimeout(()=>{this.clearErrorMessage()},3e3);this.controlElements("select.fc-control.readonly").forEach(n=>{this.makeSelectReadonly(n)});this.controlElements("input.fc-control.readonly").forEach(n=>{this.makeCheckboxReadonly(n)});this.controlElements("input[data-texttransform]").forEach(n=>{this.transformText(n)});this.configureHtmlEditors();this.setFocus();this.invokeEventHandler("RecordLoaded")}}afterSettle(n){if(this.isControlEvent(n)==!1)return!1;if(this.formBody){this.cachedMessage=null;switch(this.triggerName(n)){case"apply":this.formBody.dataset.validationpassed=="True"&&this.clientSideValidation();this.formBody.dataset.committype&&this.parentControl&&this.parentControl instanceof GridControl&&(this.cachedMessage=this.formMessage.innerText,this.parentControl.refreshPage())}}}triggerCommit(){let n=this.getButton("apply");htmx.trigger(n,"click")}clientSideValidation(){let n={mode:this.formBody.dataset.mode,message:""};this.invokeEventHandler("ValidateUpdate",n);var t=Boolean(n.message!=""||this.errorHighlighted());this.controlElement("input[name='validationPassed']").value=(t==!1).toString();t?this.setMessage(n.message!=""?n.message:"Highlighted fields are in error","error"):this.triggerCommit()}initialise(){document.body.addEventListener("htmx:configRequest",n=>{this.configRequest(n)});document.body.addEventListener("htmx:beforeRequest",n=>{this.beforeRequest(n)});document.body.addEventListener("htmx:confirm",n=>{this.confirmRequest(n)});document.body.addEventListener("htmx:afterSettle",n=>{this.afterSettle(n)});this.invokeEventHandler("Initialised")}transformText(n){n.addEventListener("input",n=>{n.preventDefault();let t=n.target;t.value=t.dataset.texttransform=="Uppercase"?t.value.toUpperCase():t.value.toLowerCase()})}updateLinkedChildControls(n){this.formContainer.dataset.linkedcontrolids&&this.updateLinkedControls(this.formContainer.dataset.linkedcontrolids,n)}makeSelectReadonly(n){"change".split(" ").forEach(function(t){n.addEventListener(t,t=>{t.preventDefault(),n.value=n.dataset.value})})}makeCheckboxReadonly(n){"click".split(" ").forEach(function(t){n.addEventListener(t,t=>{t.preventDefault(),n.checked=JSON.parse(n.dataset.value)})})}confirmRequest(n){this.isControlEvent(n)!=!1&&n.target.hasAttribute("hx-confirm-dialog")!=!1&&(n.preventDefault(),this.confirmDialog||(this.confirmDialog=new ConfirmDialog(this)),this.confirmDialog.show(n,this.formBody))}configRequest(n){this.isControlEvent(n)!=!1&&(this.htmlEditorElements().forEach(t=>{this.htmlEditorArray[t.id].assignContent(n)}),this.controlElements(".fc-control").forEach(t=>{this.elementModified(t)==!1?delete n.detail.parameters[t.name]:n.detail.parameters[t.name]==undefined&&(n.detail.parameters[t.name]="")}))}beforeRequest(n){if(this.isControlEvent(n)!=!1){switch(this.triggerName(n)){case"apply":if(this.formModified()==!1){n.preventDefault();return}if(this.form.checkValidity()==!1){this.form.reportValidity();n.preventDefault();return}case"cancel":case"primarykey":return}this.controlElements(".fc-control").forEach(n=>{n.dataset.modified=this.elementModified(n)});let t=this.controlElements(".fc-control[data-modified='true']");t.length&&(n.preventDefault(),this.setMessage(this.formBody.dataset.unappliedmessage,"warning"))}}configureHtmlEditor(n,t){this.invokeEventHandler("ConfigureHtmlEditor",{configuration:n,columnName:t})}formControlValue(n){var t=this.formControl(n);if(t){if(t.tagName=="INPUT"&&t.type=="checkbox")return t.checked;switch(t.dataset.datatype.toLowerCase()){case"datetime":return t.dataset.jsdate?new Date(Number(t.dataset.jsdate)):null;case"string":return t.value;default:return t.value?Number(t.value):null}}else console.error(`Form control for column name ${n} not found`)}highlightError(n){var t=this.formControl(n);t.dataset.error="true"}errorHighlighted(){let n=Array.from(this.controlElements(".fc-control")).filter(n=>n.dataset.error=="true").length;return n>0}setFocus(){var n=this.errorHighlighted()?".fc-control[data-error='true']":".fc-control";for(const t of this.controlElements(n))if(t.readOnly==!1&&t.disabled==!1){t.focus();break}}formControl(n){var t;return this.controlElements(".fc-control").forEach(i=>{i.name.toLowerCase()==`_${n.toLowerCase()}`&&(t=i)}),t}formModified(){let n=[];return this.controlElements(".fc-control").forEach(t=>{this.elementModified(t)&&n.push(t)}),n.length>0}elementModified(n){if(n.tagName=="INPUT"&&n.type=="checkbox")return this.isBoolean(n.dataset.value)!=n.checked;if(n.type=="select-multiple"){var t=Array.from(n.selectedOptions).map(({value:n})=>n);return(n.dataset.dbdatatype="Array")?this.cleanString(n.dataset.value)!=this.cleanString(t.join("")):n.dataset.value!=t.join(",")}return n.tagName=="TEXTAREA"?this.cleanString(n.dataset.value)!=this.cleanString(n.value):n.dataset.value!=n.value}cleanString(n){return n.replace("&amp;#xA;","").replace(/[^a-z0-9\.]+/gi,"").trim()}isBoolean(n){return n=="1"||n.toLowerCase()=="true"}setMessage(n,t="success"){this.formMessage.innerText=n;this.formMessage.dataset.highlight=t.toLowerCase();window.setTimeout(()=>{this.clearErrorMessage()},3e3)}clearErrorMessage(){this.formMessage.innerHTML="&nbsp";delete this.formMessage.dataset.highlight;this.controlElements(`.fc-control`).forEach(n=>{n.dataset.modified=!1,n.dataset.error=!1})}htmlEditorElements(){return this.controlElements("textarea[data-htmleditor]")}configureHtmlEditors(){let n=this.htmlEditorElements();if(n.length!=0){let t=n[0].dataset.htmleditor;if(!HtmlEditor.editor(t)){this.setMessage(`${t} library not available.`,"error");this.htmlEditorElements().forEach(n=>{HtmlEditor.removeElement(n),n.classList.remove("hidden"),n.removeAttribute("data-htmleditor")});this.htmlEditorMissing=!0;return}window.setTimeout(()=>{this.initHtmlEditor()},1)}}initHtmlEditor(){this.htmlEditorElements().forEach(n=>{this.htmlEditorArray[n.id]=new HtmlEditor(n,this)})}}class DraggableDialog{constructor(n,t="dialog-header",i){if(this.isDragging=!1,this.initialX=0,this.initialY=0,this.xOffset=0,this.yOffset=0,this.dialog=document.getElementById(n),this.container=i,!this.dialog)throw new Error(`Dialog with id "${n}" not found`);if(this.dragHandle=this.dialog.querySelector(`.${t}`),!this.dragHandle)throw new Error(`Drag handle with class "${t}" not found in the dialog`);this.initDragEvents()}initDragEvents(){this.dragHandle.addEventListener("mousedown",this.startDragging.bind(this));document.addEventListener("mousemove",this.drag.bind(this));document.addEventListener("mouseup",this.stopDragging.bind(this));this.xOffset=0-this.container.clientWidth/2+this.container.offsetLeft;this.yOffset=0-this.container.clientHeight/2+this.container.offsetTop;this.setTranslate(this.xOffset,this.yOffset)}startDragging(n){n.target.closest(`.${this.dragHandle.className}`)===this.dragHandle&&(this.isDragging=!0,this.initialX=n.clientX-(this.xOffset?this.xOffset:this.dialog.clientWidth/-2),this.initialY=n.clientY-(this.yOffset?this.yOffset:this.dialog.clientHeight/-2),this.dragHandle.style.cursor="move",document.body.style.userSelect="none")}drag(n){this.isDragging&&(n.preventDefault(),this.xOffset=n.clientX-this.initialX,this.yOffset=n.clientY-this.initialY,this.setTranslate(this.xOffset,this.yOffset))}stopDragging(){this.isDragging=!1;this.dragHandle.style.cursor="";document.body.style.userSelect="";document.removeEventListener("mousemove",this.drag);document.removeEventListener("mouseup",this.stopDragging)}setTranslate(n,t){requestAnimationFrame(()=>{this.dialog.style.transform=`translate3d(${n}px, ${t}px, 0)`})}}class ViewDialog{constructor(n,t){this.draggableDialog=null;this.dialog=n;this.gridControl=t;let i=this.dialog.querySelectorAll(this.gridControl.buttonSelector("close"));i.forEach(n=>{n.addEventListener("click",()=>this.dialog.close())});this.dialog.querySelector(this.gridControl.buttonSelector("previous")).addEventListener("click",()=>this.gridControl.previousRow());this.dialog.querySelector(this.gridControl.buttonSelector("next")).addEventListener("click",()=>this.gridControl.nextRow());this.gridControl.getButton("view").addEventListener("click",this.open.bind(this))}open(){this.getRecord()}close(){this.dialog&&this.dialog.open&&this.close()}show(){this.dialog.show();this.draggableDialog||(this.draggableDialog=new DraggableDialog(this.dialog.id,"dialog-nav",this.gridControl.gridControlElement("tbody")))}update(){this.dialog&&this.dialog.open&&this.getRecord()}getRecord(){let n=this.dialog.querySelector("input[hx-post]");n.value=this.gridControl.selectedRow.dataset.id;htmx.trigger(n,"changed")}configureNavigation(n){this.configureButton(n.previousElementSibling,"previous");this.configureButton(n.nextElementSibling,"next")}configureButton(n,t){this.dialog.querySelector(this.gridControl.buttonSelector(t)).disabled=!n||n.classList.contains("grid-row")==!1}columnCell(n){return this.dialog.querySelector(`div[data-columnname='${n.toLowerCase()}']`)}columnValue(n){let t=this.columnCell(n);return t?t.dataset.value:null}}class ConfirmDialog{constructor(n){this.control=n;this.dialog=this.control.controlElement(".confirm-dialog");let t=this.dialog.querySelectorAll(this.control.buttonSelector("close"));t.forEach(n=>{n.addEventListener("click",()=>this.dialog.close())});this.dialog.querySelector(this.control.buttonSelector("confirm")).addEventListener("click",()=>this.confirm());this.dialog.querySelector(this.control.buttonSelector("cancel")).addEventListener("click",()=>this.cancel())}show(n,t){this.event=n;this.dialog.show();this.dialog.style.left=this.coordinate(t.offsetLeft,t.clientWidth,this.dialog.clientWidth);this.dialog.style.top=this.coordinate(t.offsetTop,t.clientHeight,this.dialog.clientHeight)}coordinate(n,t,i){let r=t>i?(t-i)*.5:0;return`${n+i*.5+r}px`}confirm(){this.event.detail.issueRequest(!0);this.dialog.close()}cancel(){this.dialog.close()}}class HtmlEditor{constructor(n,t){this.textarea=n;this.formControl=t;this.initialise()}reset(n){switch(HtmlEditor.editorName(n)){case HtmlEditor.TinyMCE:HtmlEditor.editor("tinymce").remove(`#${n.id}`);break;case HtmlEditor.CKEditor:this.editorInstance.destroy()}}initialise(){switch(HtmlEditor.editorName(this.textarea)){case HtmlEditor.TinyMCE:this.initTinyMceEditor();break;case HtmlEditor.CKEditor:this.initCKEditorEditor();break;case HtmlEditor.Froala:this.initFroalaEditor()}}assignContent(n){switch(HtmlEditor.editorName(this.textarea)){case HtmlEditor.TinyMCE:this.textarea.value=HtmlEditor.editor("tinymce").get(this.textarea.id).getContent();n.detail.parameters[this.textarea.name]=this.textarea.value;break;case HtmlEditor.CKEditor:this.textarea.value=this.editorInstance.getData();n.detail.parameters[this.textarea.name]=this.textarea.value;break;case HtmlEditor.Froala:this.textarea.value=this.editorInstance.html.get(!0);n.detail.parameters[this.textarea.name]=this.textarea.value}}initTinyMceEditor(){var n={selector:`#${this.textarea.id}`,license_key:"gpl"};this.updateConfiguration(n);HtmlEditor.editor("tinymce").init(n)}updateConfiguration(n){this.formControl.configureHtmlEditor(n,this.textarea.name.substring(1))}initCKEditorEditor(){const{ClassicEditor:t,Essentials:i,Bold:r,Italic:u,Font:f,Paragraph:e}=window.CKEDITOR;let n={licenseKey:"",plugins:[i,r,u,f,e],toolbar:["undo","redo","|","bold","italic","|","fontSize","fontFamily","fontColor","fontBackgroundColor"]};this.updateConfiguration(n);t.create(document.querySelector(`#${this.textarea.id}_ckeditor`),n).then(n=>{this.editorInstance=n})}initFroalaEditor(){this.editorInstance=new window.FroalaEditor(`#${this.textarea.id}_froala`)}static editorName(n){return n.dataset.htmleditor}static removeElement(n){switch(HtmlEditor.editorName(n)){case HtmlEditor.Froala:case HtmlEditor.CKEditor:document.querySelector(`#${n.id}_${HtmlEditor.editorName(n).toLowerCase()}`).remove()}}static editor(n){switch(n){case HtmlEditor.TinyMCE:n=n.toLowerCase();break;case HtmlEditor.Froala:n="FroalaEditor";break;case HtmlEditor.CKEditor:n="CKEDITOR"}return window[n]}}HtmlEditor.TinyMCE="TinyMCE";HtmlEditor.CKEditor="CKEditor";HtmlEditor.Froala="Froala";