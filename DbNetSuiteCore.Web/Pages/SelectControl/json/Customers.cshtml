@page
@using DbNetSuiteCore.Enums
@using DbNetSuiteCore.Web.Enums
@using DbNetSuiteCore.Web.Helpers
@using DbNetSuiteCore.Models
@using Microsoft.Extensions.Primitives
@using System.Net.Http
@{
    var columns = new List<SelectColumn>() {
        new SelectColumn("CustomerID"),
        new SelectColumn("CompanyName")
    };

    var port = Request.Query["port"] == StringValues.Empty ? new StringValues(string.Empty) : Request.Query["port"];
    var mode = Request.Query["mode"] == StringValues.Empty ? new StringValues(string.Empty) : Request.Query["string"];

    var url = String.IsNullOrEmpty(port.ToString()) ? "/data/json/customers.json" : $"https://localhost:{port}/customers";

    SelectModel customerSelect;
    if (port != string.Empty && mode != string.Empty)
    {
        HttpClient client = new HttpClient();
        string json = await client.GetStringAsync(url);
        customerSelect = new SelectModel(DataSourceType.JSON, json) { Columns = columns, Searchable = true, Cache = false };
    }
    else
    {
        customerSelect = new SelectModel(DataSourceType.JSON, url) { Columns = columns, Searchable = true, Cache = false };
    }

    @(await new DbNetSuiteCore.SelectControl(HttpContext).Render(customerSelect))
}