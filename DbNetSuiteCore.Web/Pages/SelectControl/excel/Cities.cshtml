@page
@using DbNetSuiteCore.Enums
@using DbNetSuiteCore.Helpers
@using DbNetSuiteCore.Models
@using DbNetSuiteCore.Web.Enums

@{
    var citySelect = new SelectModel(DataSourceType.Excel, "/Data/excel/cities.csv") { Caption = "City", Distinct = true };
    citySelect.Columns = new List<SelectColumn>
    {
        new SelectColumn("id") {PrimaryKey = true },
        new SelectColumn("name"),
        new SelectColumn("state_code") { ForeignKey = true }
    };
  

    var stateSelect = new SelectModel(DataSourceType.Excel, "/Data/excel/cities.csv") { Caption = "State", Distinct = true };
    stateSelect.Columns = new List<SelectColumn>
    {
        new SelectColumn("state_code") {PrimaryKey = true },
        new SelectColumn("state_name"),
        new SelectColumn("country_code") { ForeignKey = true }
    };

    var countrySelect = new SelectModel(DataSourceType.Excel, "/Data/excel/cities.csv") { Caption = "Country", Distinct = true };
    countrySelect.Columns = new List<SelectColumn>
    {
        new SelectColumn("country_code") {PrimaryKey = true },
        new SelectColumn("country_name")
    };

    stateSelect.LinkedControl = citySelect;
    countrySelect.LinkedControl = stateSelect;
    stateSelect.Bind(SelectClientEvent.OptionsLoaded,"setStateCaption");
    stateSelect.Bind(SelectClientEvent.OptionsLoaded,"setCityCaption");
   
}
@(await new DbNetSuiteCore.Control(HttpContext).Render(countrySelect))
@(await new DbNetSuiteCore.Control(HttpContext).Render(stateSelect))
@(await new DbNetSuiteCore.Control(HttpContext).Render(citySelect))

<script>
function setStateCaption(selectControl, args) { 
    selectControl.setCaption(`State (${selectControl.parentControl.select.selectedOptions[0].text})`);
}

function setCityCaption(selectControl, args) {
    selectControl.setCaption(`City (${selectControl.parentControl.select.selectedOptions[0].text})`);
}
</script>
