@page
@using DbNetSuiteCore.Enums
@using DbNetSuiteCore.Web.Helpers
@using DbNetSuiteCore.Models

@{
    var productForm = new FormModel(DataSourceType.MSSQL, ConnectionStringHelper.TestConnectionString(Request.Query["db"], DataSourceType.MSSQL), "Products") { Insert = true, Delete = true, ToolbarPosition = ToolbarPosition.Bottom };
    productForm.Columns = new List<FormColumn>() {
        new FormColumn("ProductID","ID"),
        new FormColumn("ProductName", "Name"),
        new FormColumn("SupplierID","Supplier") { Lookup = new Lookup("Suppliers", "SupplierId", "CompanyName"),Required = true },
        new FormColumn("CategoryID","Category") { Lookup = new Lookup("Categories", "CategoryID", "CategoryName"),Required = true, HelpText = "Select a category for the product" },
        new FormColumn("QuantityPerUnit", "Qty"){ InitialValue = 0},
        new FormColumn("UnitPrice", "Price") {Required = true,InitialValue = 0, MinValue = 0, MaxValue = 100 },
        new FormColumn("UnitsInStock", "Stock") {Required = true,InitialValue = 0, MinValue = 0 },
        new FormColumn("UnitsOnOrder", "On Order") {Required = true,InitialValue = 0 },
        new FormColumn("ReorderLevel", "Re-order Level") {Required = true,InitialValue = 0, MaxValue = 50, HelpText = "here is some help text" },
        new FormColumn("Discontinued") {DataType = typeof(bool), InitialValue = true, HelpText = "Discontinued products must have a re-order level of 0"}
    };

    productForm.Bind(FormClientEvent.ValidateUpdate,"validateReOrderLevel");
    productForm.Bind(FormClientEvent.ValidateDelete,"validateDelete");
    @(await new DbNetSuiteCore.Control(HttpContext).Render(productForm))
}

<script>
function validateReOrderLevel(formControl, args) {
    if (formControl.formControlValue("discontinued") && formControl.formControlValue("ReorderLevel") > 0) {
        formControl.highlightError("discontinued");
        formControl.highlightError("ReorderLevel");
        args.message = `Re-order level must be zero for discontinued products`;
    }
}

function validateDelete(formControl, args) {
    if (formControl.formControlDbValue("discontinued") == false) {
        formControl.highlightError("discontinued");
        args.message = `Only discontinued products can be deleted`;
    }
}
</script>