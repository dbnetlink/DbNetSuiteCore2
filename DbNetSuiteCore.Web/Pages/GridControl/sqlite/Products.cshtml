@page
@using DbNetSuiteCore.Enums
@using DbNetSuiteCore.Models
@using DbNetSuiteCore.Web.Enums

@{
	var productsGrid = new GridModel(DataSourceType.SQLite, "Northwind(sqlite)", "Products") { Search = true, ViewDialog = new ViewDialog() { LayoutColumns = 2 } };
	productsGrid.Columns = new List<GridColumn>() {
		new GridColumn("ProductID") { PrimaryKey = true, Search = false },
		new GridColumn("ProductName"),
		new GridColumn("SupplierID","Supplier") { Lookup = new Lookup("Suppliers", "SupplierId", "CompanyName"), Filter = FilterType.Default },
		new GridColumn("CategoryID","Category") { Lookup = new Lookup("Categories", "CategoryID", "CategoryName"), Filter = FilterType.Default },
		new GridColumn("QuantityPerUnit", "Qty."),
		new GridColumn("UnitPrice","Price") { Format = "c"},
		new GridColumn("UnitsInStock", "Stock"),
		new GridColumn("UnitsOnOrder","On Order"),
		new GridColumn("ReorderLevel") { Search = false },
		new GridColumn("Discontinued") { DataType = typeof(Boolean), Filter = FilterType.Default, LookupEnum = typeof(DiscontinuedEnum)}
	};

//	productsGrid.FixedFilter = "UnitPrice > @unitprice";
//	productsGrid.FixedFilterParameters.Add(new DbParameter("@unitprice", 50));

	productsGrid.Bind(GridClientEvent.RowTransform, "highlightGridLowStock");
	productsGrid.Bind(GridClientEvent.ViewDialogUpdated, "highlightViewLowStock");

	@(await new DbNetSuiteCore.Control(HttpContext).Render(productsGrid))
}
<script>
	//var unitsInStockName = "H4sIAAAAAAAACivNyywpzswrLslPzgYAxGA4xgwAAAA="
	//var reorderLevelName = "H4sIAAAAAAAACitKzS9KSS3KSS1LzQEAFw2T+wwAAAA="
	//var discontinuedName = "H4sIAAAAAAAACkvJLE7OzyvJzCtNTQEAM3XNDgwAAAA="
	var unitsInStockName = "UnitsInStock"
	var reorderLevelName = "ReorderLevel"
	var discontinuedName = "Discontinued"

	function highlightGridLowStock(gridControl, args) {
		highlightLowStock(gridControl, args.row);
		highlightDiscontinued(gridControl, args.row);
	}

	function highlightViewLowStock(gridControl, args) {
		highlightLowStock(args.viewDialog)
	}

	function highlightLowStock(control, row) {
		var unitsInStock = parseInt(control.columnValue(unitsInStockName, row));
		var reorderLevel = parseInt(control.columnValue(reorderLevelName, row));

		if (unitsInStock < reorderLevel) {
			if (row) {
				row.style.fontWeight = "bold";
			}
			let unitsInStockCell = control.columnCell(unitsInStockName, row);
			let reorderLevelCell = control.columnCell(reorderLevelName, row);

			unitsInStockCell.style.backgroundColor = "#CD6155"
			unitsInStockCell.style.color = "#F2D7D5";

			reorderLevelCell.style.backgroundColor = "#CD6155"
			reorderLevelCell.style.color = "#F2D7D5";
		}
	}

	function highlightDiscontinued(gridControl, row) {

		if (gridControl.columnValue(discontinuedName, row) == "Active") {
			return
		}

		console.log(gridControl.columnValue(discontinuedName, row))

		row.style.opacity = "50%";
	}
</script>
