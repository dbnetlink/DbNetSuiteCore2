@page
@using DbNetSuiteCore.Enums
@using DbNetSuiteCore.Helpers
@using DbNetSuiteCore.Models

@{
    <p style="width:700px; padding-bottom:20px">These are Razor page samples. MVC samples <a href="/home/index">here</a></p>

    var samplesGrid = new GridModel(DataSourceType.FileSystem, "../Pages") { FixedFilter = "(IsDirectory = 1 or Name like '%.cshtml') and Name not in ('Shared','_ViewStart.cshtml','index.cshtml')" };
    samplesGrid.Columns = new List<GridColumn>()
    {
        new GridColumn(FileSystemColumn.Name.ToString()),
        new GridColumn(FileSystemColumn.Content.ToString(), "Summary") { RegularExpression = "<p data-summary>(.*?)</p>"}
    }; 
    samplesGrid.ToolbarPosition = ToolbarPosition.Hidden;
    samplesGrid.ClientEvents[GridClientEvent.CellTransform] = "createLink";

    @(await new DbNetSuiteCore.Control(HttpContext).Render(samplesGrid))
}
<script>
    function createLink(gridControl, args) {
        var tbody = args.cell.closest("tbody")
        var url = tbody.dataset.url.toString().toLowerCase().replace('../pages', '')
        
        switch (args.columnName.toLowerCase()) 
        { 
            case "name":
                var name = args.cell.dataset.value.toString()
                if (name.endsWith(".cshtml") && name.startsWith("_") == false) {
                    args.cell.innerHTML = `<a target='_blank' href='${window.location.origin}${url}/${name.replace(".cshtml", "")}'>${name.replace(".cshtml", "")}</a>`
                }
                break;
        }
    }
</script>
